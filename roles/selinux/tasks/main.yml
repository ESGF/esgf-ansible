
- name: Install libselinux-python
  package:
    name: libselinux-python

- name: Set SELinux to permissive
  selinux:
    policy: targeted
    state: permissive
  register: selinux_result

- name: Install firewalld
  when: is_7 and (configure_centos7_firewalld is defined and configure_centos7_firewalld)
  package:
    name: firewalld

- name: Enable firewalld
  when: is_7 and (configure_centos7_firewalld is defined and configure_centos7_firewalld)
  service:
    name: firewalld
    enabled: yes
  register: firewalld_enabled

- name: Determine if a reboot should occur
  set_fact:
    should_reboot: (selinux_result.reboot_required or (is_7 and firewalld_enabled is defined and firewalld_enabled is changed))

- name: End execution if it is determined this machine requires a reboot
  when: should_reboot
  fail:
    msg: It has been determined that a reboot of {{ ansible_fqdn }} is required to continue. Please reboot {{ ansible_fqdn }} then restart the deployment.