
- name: Install needed libraries for certificate generation
  yum:
    name: python2-cryptography

# Check for present certificate
- name: Check if {{ cert_dest }} exists
  when: cert_dest is defined
  stat:
    path: "{{ cert_dest }}"
  register: certpath

- name: Make a backup of {{ cert_dest }} to {{ cert_dest }}.{{ ansible_date_time.epoch }}
  when: cert_dest is defined and certpath.stat.exists
  copy:
    remote_src: yes
    src: "{{ cert_dest }}"
    dest: "{{ cert_dest }}.{{ ansible_date_time.epoch }}"

- name: Move certificate
  when: cert_dest is defined and certpath.stat.exists
  file:
    path: "{{ cert_dest }}"
    state: absent

- name: "{{ common_name }} Certificate Tasks"
  import_tasks: cert.yml